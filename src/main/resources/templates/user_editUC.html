<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Unit Course (UC)</title>
    <link rel="stylesheet" type="text/css" href="/css/user_editUC.css">
</head>

<body>
    <header>
        <nav>
            <button onclick="window.location.href='/logout'">Logout</button>
            <button onclick="window.location.href='/backUser'">Back</button>
        </nav>
    </header>

    <main>
        <section class="section">
            <h2>Edit Unit Course Details</h2>

            <!-- Form to update the UC details -->
            <form th:action="@{/user_editUC/{id}(id=${uc.id})}" method="POST">
                <label for="nameUC">Name of UC:</label>
                <input type="text" id="nameUC" name="nameUC" th:value="${uc.nameUC}" required>
                <br><br>

                <label for="studentsNumber">Number of Students:</label>
                <input type="number" id="studentsNumber" name="studentsNumber" th:value="${uc.studentsNumber}" required>
                <br><br>

                <!-- Type of UC - only Continuous or Mixed -->
                <label for="typeUC">Type of UC:</label>
                <select name="typeUC" id="typeUC" required>
                    <option value="Continuous" th:selected="${uc.typeUC == 'Continuous'}">Continuous</option>
                    <option value="Mixed" th:selected="${uc.typeUC == 'Mixed'}">Mixed</option>
                </select>
                <br><br>

                <!-- Automatically Set Evaluation Type Based on UC Type -->
                <h3>Define Evaluation Types</h3>

                <label for="attendance">Attendance Required:</label>
                <select id="attendance" name="attendance">
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>

                <!-- Number of Evaluations to Add -->
                <label for="num-evaluations">How many evaluations would you like to add?</label>
                <input type="number" id="num-evaluations" name="num-evaluations" min="1" required onchange="updateEvaluationFields()">
                <br><br>

                <!-- Evaluation Type List -->
                <div id="evaluation-list"></div>
                <br><br>

                <button type="submit">Update UC</button>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 University - Academic Administration System</p>
    </footer>

    <script>
        const evaluationOptions = [
            'Test',
            'Final Exam in Exam Period',
            'Work Developed Throughout the Semester',
            'Work Submission',
            'Group Work Submission',
            'Work Presentation',
            'Group Work Presentation',
            'Monograph',
            'Individual Practical Exercise',
            'Pitch',
            'Final Exam',
            'Oral Exam'
        ];

        // Set Evaluation Type Automatically Based on UC Type
        window.onload = function () {
            const typeUCField = document.getElementById('typeUC');
            const numEvaluationsField = document.getElementById('num-evaluations');

            // Update fields on page load
            updateEvaluationTypeAndMin(typeUCField.value, numEvaluationsField);

            // Add listener for changes in UC type
            typeUCField.addEventListener('change', function () {
                updateEvaluationTypeAndMin(this.value, numEvaluationsField);
            });
        };

        // Function to update evaluation type and minimum number
        function updateEvaluationTypeAndMin(typeUC, numEvaluationsField) {
            if (typeUC === 'Mixed') {
                numEvaluationsField.value = 2;
                numEvaluationsField.setAttribute('min', 2);
            } else if (typeUC === 'Continuous') {
                numEvaluationsField.value = 3;
                numEvaluationsField.setAttribute('min', 3);
            }
            updateEvaluationFields();
        }

        // Function to update evaluation fields
        function updateEvaluationFields() {
            const numEvaluations = document.getElementById('num-evaluations').value;
            const evaluationList = document.getElementById('evaluation-list');
            evaluationList.innerHTML = '';

            // If no evaluations are added, do nothing
            if (numEvaluations == 0) return;

            for (let i = 0; i < numEvaluations; i++) {
                const div = document.createElement('div');
                div.classList.add('evaluation-item');
                div.style.marginBottom = '20px'; // Add spacing for better visual separation

                // Evaluation Type
                const labelType = document.createElement('label');
                labelType.textContent = `Evaluation ${i + 1} Type:`;
                const selectType = document.createElement('select');
                selectType.name = `evaluation-type-${i}`;
                evaluationOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    selectType.appendChild(optionElement);
                });

                // Weight
                const labelWeight = document.createElement('label');
                labelWeight.textContent = `Evaluation ${i + 1} Weight (%):`;
                const inputWeight = document.createElement('input');
                inputWeight.type = 'number';
                inputWeight.name = `evaluation-weight-${i}`;
                inputWeight.min = '0';
                inputWeight.max = '100';

                // Exam Period
                const labelExamPeriod = document.createElement('label');
                labelExamPeriod.textContent = `Evaluation ${i + 1} Exam Period:`;
                const selectExamPeriod = document.createElement('select');
                selectExamPeriod.name = `evaluation-exam-period-${i}`;
                const periods = ['None', 'Teaching Period', 'Exam Period', 'Resource Period', 'Special Period'];
                periods.forEach(period => {
                    const optionPeriod = document.createElement('option');
                    optionPeriod.value = period;
                    optionPeriod.textContent = period;
                    selectExamPeriod.appendChild(optionPeriod);
                });

                // Requires Computer
                const labelComputer = document.createElement('label');
                labelComputer.textContent = `Evaluation ${i + 1} Requires Computer:`;
                const inputComputer = document.createElement('input');
                inputComputer.type = 'checkbox';
                inputComputer.name = `evaluation-computer-${i}`;

                // Time of Class (checkbox)
                const labelClassTime = document.createElement('label');
                labelClassTime.textContent = `Evaluation ${i + 1} at usual class time?`;
                const inputClassTime = document.createElement('input');
                inputClassTime.type = 'checkbox';
                inputClassTime.name = `evaluation-class-time-${i}`;
                inputClassTime.id = `evaluation-class-time-${i}`;
                inputClassTime.onclick = function () { toggleRoomField(i); };

                // Date and Time Start & End
                const labelDateStart = document.createElement('label');
                labelDateStart.textContent = `Evaluation ${i + 1} Start Date & Time:`;
                const inputDateStart = document.createElement('input');
                inputDateStart.type = 'datetime-local';
                inputDateStart.name = `evaluation-date-start-${i}`;

                const labelDateEnd = document.createElement('label');
                labelDateEnd.textContent = `Evaluation ${i + 1} End Date & Time:`;
                const inputDateEnd = document.createElement('input');
                inputDateEnd.type = 'datetime-local';
                inputDateEnd.name = `evaluation-date-end-${i}`;

                // Room (if not usual class time)
                const labelRoom = document.createElement('label');
                labelRoom.textContent = `Room for Evaluation ${i + 1}:`;
                const inputRoom = document.createElement('input');
                inputRoom.type = 'text';
                inputRoom.name = `evaluation-room-${i}`;
                inputRoom.id = `evaluation-room-${i}-input`;
                inputRoom.value = "Room 1";  // Set default room value to "Room 1"

                // Append all inputs to the div
                div.appendChild(labelType);
                div.appendChild(selectType);
                div.appendChild(labelWeight);
                div.appendChild(inputWeight);
                div.appendChild(labelExamPeriod);
                div.appendChild(selectExamPeriod);
                div.appendChild(labelComputer);
                div.appendChild(inputComputer);
                div.appendChild(labelClassTime);
                div.appendChild(inputClassTime);
                div.appendChild(labelDateStart);
                div.appendChild(inputDateStart);
                div.appendChild(labelDateEnd);
                div.appendChild(inputDateEnd);
                div.appendChild(labelRoom);
                div.appendChild(inputRoom);

                // Append the div to the evaluation list
                evaluationList.appendChild(div);
            }
        }

        // Function to disable room input when class time is checked
        function toggleRoomField(i) {
            const classTimeCheckbox = document.getElementById(`evaluation-class-time-${i}`);
            const roomInput = document.getElementById(`evaluation-room-${i}-input`);
            if (classTimeCheckbox.checked) {
                roomInput.disabled = true; // Disable the room input
            } else {
                roomInput.disabled = false; // Enable the room input
            }
        }
    </script>
</body>

</html>
